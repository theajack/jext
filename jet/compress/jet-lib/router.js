!function(){var f="Jrouter",e="jrouter-active",d="JrouteScript",p=new RegExp("new Jet\\([ |\r\n]*\\)","i"),m=new RegExp("JET\\([ |\r\n]*\\)","i"),b="F",T=Jet.__base__;Jet.__base__._useList.push("router");var g=T._JT,r=T.__ROOT,o=T._scoped_style_id;function u(t,e){if(t===Jet.router.index&&(Jet.router.indexMap=e),"string"!=typeof e){var r="";if("params"in e){for(var o in r="?",e.params)r+=o+"="+e.params[o]+"&";r=r.substring(0,r.length-1)}i(t,e.name,r);var n=e.children;for(var o in n)u(t+o,n[o])}else i(t,e)}function i(t,e,r){e._JT_has(".html")||(e._JT_has("?")?e=e.replace("?",".html?"):e+=".html"),null!=r&&(e+=r),Jet.router.map[Jet.router.base+t]=e}function v(t,e){e||function(t){var e;if("__onroute"==t){if(!(e=Jet._unnamedJets[T.__router_comp]))return;n((Jet.router.__last_router_comp=e)._tools._beforeunmount),function t(e){if(!e)return;for(var r in e)n(e[r]._tools._beforeunmount),t(e[r].$child)}(e.$child)}else if("__onrouted"==t){if(!(e=Jet.router.__last_router_comp))return;a(e),function t(e){if(!e)return;for(var r in e)a(e[r]),t(e[r].$child)}(e.$child)}}(t),Jet.router[t].forEach(function(t){t._jet?t.call(t._jet,e,Jet.router):t.call(Jet.router,e)})}function n(t){t&&t()}function a(t){var e=t._tools.name;n(t._tools._onunmounted);var r=t._tools._ele[o];r&&"RouterOut"!==r&&g.attr(o+"="+r)._JT_remove(),_("__onroute",e),_("__onrouted",e),Jet.comp[e]&&Jet.comp[e].$DOM?delete Jet.comp[e]:Jet._unnamedJets[e]&&delete Jet._unnamedJets[e]}function _(e,r){var t=Jet.router[e].filter(function(t){return t._name===r});0<t.length&&t.forEach(function(t){Jet.router[e]._JT_remove(t)})}Jet.router={base:"",trueBase:!1,history:!1,path:"/",lastTrueHash:"",params:null,map:{},_initRouterOut:function(){return Jet.router.out&&Jet.router.out._JT_exist()||(Jet.router.out=g.attr("Jout")),Jet.router.out},use:function(t){Jet.router.index="index"in t?t.index:"/index",function(t){for(var e in"history"in t&&(Jet.router.history=t.history),"base"in t&&Jet.router.setBase(t.base,t.trueBase),t.history||(Jet.router.base+="/#"),t.router["/404"]||(t.router["/404"]="/404"),t.router)""==t.router[e]&&(t.router[e]=e),u(e,t.router[e])}(t);var e=Jet.router.index;location.pathname._JT_has("index.html")||(Jet.router.history?1<location.pathname.length-Jet.router.base.length&&(e=location.pathname.substring(Jet.router.base.length)+location.search+location.hash):2<location.hash.length&&(e=(e=location.pathname+location.hash).substring(Jet.router.base.length)+location.search)),Jet.router._initRouterOut(),Jet.router.init(),Jet.router.__await=function(){t.oninit&&"function"==typeof t.oninit&&t.oninit(),Jet.router.__isFresh=!0,Jet.router.route(e),delete Jet.router.__await},Jet.router.__hasInitJet&&(Jet.router.__await(),delete Jet.router.__hasInitJet),g.id(r)._JT_exist(function(t){t._JT_attr(T._jload,"root.html")._JT_attr(T._jpath,"false"),T._initSingleLoad("root",t,0,[t],function(){t._JT_removeAttr(T.__comp_id)})})},conf:{html:"/src/html",js:"/src/js",css:"/src/css",image:"/src/image",media:"/src/media",base:"/src"},init:function(t){(null==t?g.attr(f):t._JT_findAttr(f))._JT_each(function(t){t._JT_clk(function(){Jet.router.route(this._JT_attr(f))})})},setBase:function(t,e){if(Jet.router.base=t,!0===e)for(var r in Jet.router.trueBase=!0,Jet.router.conf)Jet.router.conf[r]=t+Jet.router.conf[r]},__xhr:null,__onroute:[],onroute:function(t,e){"function"==typeof t?(t._jet=e,t._name=e._tools.name,Jet.router.__onroute.push(t)):_throw("onroute:参数必须是函数")},__onrouted:[],onrouted:function(t,e){"function"==typeof t?(t._jet=e,t._name=e._tools.name,Jet.router.__onrouted.push(t)):_throw("onroute:参数必须是函数")},back:function(){window.history.back()},forward:function(){window.history.forward()},activeRouter:function(t){(t=t||g.attr(f+'="'+Jet.router.url+'"'))._JT_exist()&&(g.attr(e)._JT_removeAttr(e),t._JT_attr(e,""),Jet.router.active=t)},route:function(t,e,o){if(t._JT_has("http://")||t._JT_has("https://"))!0===e?Jet.$.open(t):Jet.$.jump(t);else{var n=Jet.router.__isFresh;n&&(Jet.router.__isFresh=!1),v("__onroute",n),null!==Jet.router.__xhr&&(Jet.router.__xhr.abort(),T._info("忽略了一个路由："+Jet.router.path+"；可能是由于点击过快"),Jet.router.__xhr=null);var r=function(t){var e="";if(-1!=t.indexOf("#")){var r=t.indexOf("?"),o=t.indexOf("#");-1!=r?o<r?(Jet.router.hash=t.substring(o,r),e=t.substring(r+1),t=t.substring(0,o),r=o):(Jet.router.hash=t.substring(o),e=t.substring(r+1,o),t=t.substring(0,r)):(Jet.router.hash=t.substring(o),r=o,t=t.substring(0,o))}else t._JT_has("?")&&(e=t.substring(t.indexOf("?")+1),t=t.substring(0,t.indexOf("?"))),Jet.router.hash="";"/"==t[t.length-1]&&1<t.length&&(t=t.substring(0,t.length-1));return{url:t,search:e}}(t),u=r.search;t=r.url;var i=g.attr(f+'="'+t+'"');Jet.router.activeRouter(i);var a=!1;(t=function(t){"/"==t[t.length-1]&&"/"!=t&&(t=t.substring(0,t.length-1));t=t==Jet.router.base?Jet.router.base+Jet.router.index:"/"!=t[0]?Jet.router.path+"/"+t:Jet.router.base+t;return t}(t))in Jet.router.map||(t=Jet.router.base+"/404",a=!0);var _=Jet.router.map[t];if(null!=_){if(_._JT_has("?")){if(""==u)u=_.substring(_.indexOf("?")+1);else{var s=_.substring(_.indexOf("?")+1).split("&"),J=u.split("&");s.forEach(function(t){-1==J.indexOf(t)&&(u+="&"+t)})}_=_.substring(0,_.indexOf("?")),a=!0}""!=u&&(u="?"+u),Jet.router.path=t,Jet.router.url=t.substring(Jet.router.base.length);var c={},l=t,h=t+u+Jet.router.hash;"function"==typeof e&&(o=e,e=void 0),null==e&&history.pushState(c,l,h),a&&history.replaceState(c,l,h),Jet.router.params=g.urlParam(),Jet.router.lastTrueHash=location.hash,"undefined"!=typeof JUI&&JUI.dialog.removeAll(),Jet.router.__xhr=g.load(T._getSrc(_,"html"),function(t){Jet.router.__xhr=null;var e,r=Jet.router._initRouterOut()._JT_html(t);"undefined"!=typeof JUI&&(JUI._jui_mounted=[]),e=r,!T._isUd(Jet.__css_conf)&&T._isUd(Jet.__css_conf.conf)?Jet.__css_conf._reloadCssConf(function(){T._loadStyleCall(e,Jet.router.path,!0)}):(T._isUd(Jet.__css_conf)||(Jet.__css_conf.xhr=void 0),T._loadStyleCall(e,Jet.router.path,!0)),function(t){g.id(d)._JT_exist()&&g.id(d)._JT_remove();var r,o=g.ct("script")._JT_attr({id:d,type:"text/javascript"}),n=["//# sourceURL=__router_comp_"+(b="T"==b?"F":"T")+".js\r\n"],e=t._JT_findTag("script")._JT_toArray(!1);0<e.length&&(r=T.__router_comp,t._JT_attr(T.__comp_id,r));for(var u=-1,i=e.length-1;0<=i;i--)if(e[i]._JT_hasAttr("src")){u=i;break}var a=function(t){var e='"'+T.__jet_root+'","'+r+'",';return null!==t.match(p)?t.replace(p,"new Jet("+e+"{})"):null!==t.match(m)?t.replace(m,"JET("+e+"{})"):t.replace("new Jet(","new Jet("+e).replace("JET(","JET("+e)};e._JT_each(function(t,e){if(t._JT_hasAttr("src"))g.load(T._getSrc(t._JT_attr("src"),"js"),function(t){t=T._babel(t),n[e+1]=a(t),e==u&&(o._JT_html(n.join("")),g.body()._JT_append(o))});else{var r=T._babel(t._JT_html());n[e+1]=a(r)}t._JT_remove()}),-1==u&&(o._JT_html(n.join(";")),g.body()._JT_append(o))}(r),T._loadCompRes(r),T._initValidAndLang(r),Jet.router.init(r),"undefined"!=typeof JUI&&JUI.init(r),Jet.load.init(r),o&&o(),v("__onrouted",n)})}}}},Jet.prototype.$route=function(t,e){Jet.router.route(t,e)},Jet.prototype.$route.back=function(t){Jet.router.back()},Jet.prototype.$route.forward=function(t){Jet.router.forward()},window.onhashchange=function(){Jet.router.lastTrueHash!=location.hash&&window.onpopstate()},window.onpopstate=function(t){Jet.router.history?Jet.router.route(location.pathname.substring(Jet.router.base.length)+location.search+location.hash,!1):Jet.router.route(location.hash.substring(1),!1)}}();